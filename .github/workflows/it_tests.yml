name: IT Tests

on:
  push:
    branches:
      - master
      - develop
  pull_request:
    branches:
      - master
      - develop
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 'Downloading Gateway'
        uses: actions/checkout@v2
        with:
          token: ${{ secrets.PAT }}
          repository: ansotolab/lca-gateway
          path: ${{ env.GITHUB_WORKSPACE }}/lca-gateway
      - name: 'Run Gateway'
        run: cd ${{ env.GITHUB_WORKSPACE }}/lca-gateway && mvn spring-boot:run
      - name: 'Downloading Registry'
        uses: actions/checkout@v2
        with:
          token: ${{ secrets.PAT }}
          repository: ansotolab/lca-registry
          path: ${{ env.GITHUB_WORKSPACE }}/lca-registry
      - name: 'Run Registry'
        run: cd ${{ env.GITHUB_WORKSPACE }}/lca-registry && mvn spring-boot:run
      - name: 'Change to lca-folder folder'
        run: cd ${{ env.GITHUB_WORKSPACE }}/lca-customer
      - name: 'IT Postman Tests'
        uses: matt-ball/newman-action@master
        with:
          collection: postman-customer.json